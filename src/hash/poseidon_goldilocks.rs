//!
//! Implementations for Poseidon over Goldilocks field of widths 8 and 12.
//!
//! These contents of the implementations *must* be generated using the
//! `poseidon_constants.sage` script in the `mir-protocol/hash-constants`
//! repository.

use crate::field::goldilocks_field::GoldilocksField;
use crate::hash::poseidon::{Poseidon, N_PARTIAL_ROUNDS};

#[rustfmt::skip]
impl Poseidon<8> for GoldilocksField {
    // The MDS matrix we use is the circulant matrix with first row given by the vector
    // [ 2^x for x in MDS_MATRIX_EXPS] = [1, 1, 2, 1, 8, 32, 2, 256]
    //
    // WARNING: If the MDS matrix is changed, then the following
    // constants need to be updated accordingly:
    //  - FAST_PARTIAL_ROUND_CONSTANTS
    //  - FAST_PARTIAL_ROUND_VS
    //  - FAST_PARTIAL_ROUND_W_HATS
    //  - FAST_PARTIAL_ROUND_INITIAL_MATRIX
    const MDS_MATRIX_EXPS: [u64; 8] = [0, 0, 1, 0, 3, 5, 1, 8];

    const FAST_PARTIAL_FIRST_ROUND_CONSTANT: [u64; 8]  = [
        0x66bbd30e99d311da, 0x423feb9d01ac907c, 0x266103d701f3cb06, 0x69b9fadf6ba012e6,
        0x7ecbafe6419d78f0, 0x0bba56b1cb8e5783, 0x982d63a65094a0f0, 0x3fe5954b168e198b,
    ];

    const FAST_PARTIAL_ROUND_CONSTANTS: [u64; N_PARTIAL_ROUNDS]  = [
        0x3c4a320345f57b0a, 0x95aade79c36124ee, 0x7da3019ce4b91dd9, 0xfca6cd4ccdd71989,
        0x260e6737a8afe7f8, 0x0658d70e72c04dd1, 0x370a0e9592096762, 0xecb2f1b527e531d0,
        0x4909b3ba6e0e6e9f, 0x4b9bd9af61547fd3, 0x4da696bf1b3eaa6d, 0xe95e7854ce207a2d,
        0xecc13e12f9eae5d2, 0x63c4b54f246fe941, 0x15cc60b28b8fdf94, 0x88c45a591170e726,
        0x44b5843e881e64c0, 0x9fc1c11128e4cc47, 0x0a23b662cd2b02f6, 0x5d7ba2a88ba30caf,
        0x32834de6bcef1733, 0x0,
    ];

    const FAST_PARTIAL_ROUND_VS: [[u64; 8 - 1]; N_PARTIAL_ROUNDS] = [
        [0xb095a9bdee6630b0, 0xcbbcf59ef8738b58, 0x6d237af91034a477, 0xf4fb4ffc173c5cb8,
         0x55f9096fde8756d8, 0xd477f84ed5469c4c, 0xe15a447a4dedd837, ],
        [0x5cff5f020633a75e, 0x6c2db514597a2116, 0x435a8c01d4d26939, 0xb40f5c5c94a6abb6,
         0x368b2b0a4266d5e5, 0xad372b9191e96cdd, 0xa8b2ab5480044fb3, ],
        [0x9431e23bfeb3032c, 0xf6d4704d69950c5c, 0xad0f9bc72df1350d, 0x6708d2dea5b0b368,
         0x38ba688e0a480521, 0xb4adaa40d2cbd2f4, 0x5aa43ab2784ef974, ],
        [0x39d2804c8921a038, 0x0f4f641fb179a95a, 0xbd2d37454f0f5e80, 0x6b1c94706be497f9,
         0xaf8e06b34202135b, 0x2ed75bdfca140e98, 0x071ea49a33c0fb6b, ],
        [0x66d0c98f2669692e, 0x402a4fcb4220e489, 0xd7612a1f997017d3, 0x1a8df9bf7254a65a,
         0x5a6fb60d56aa76e8, 0xa5b494949406166b, 0x9fbb6aeda2a5fbfe, ],
        [0x4aa7dd9225a342d4, 0xfdbcc6f9d0d3373b, 0xe043ff7173a74d59, 0xbfdbc685a67ace01,
         0xbd2b2a366c62c810, 0xb5376de196f8dc4b, 0x06e0a8ca2ffbde56, ],
        [0xe5995f6a9d7e2d12, 0xffd8cd1775f5bcc9, 0x9cfe56cd765f2739, 0x94a0653905127e10,
         0x34387f4f1f2a744e, 0xa3e74af37ac2228c, 0xbbf5a29c67634c51, ],
        [0x69c3e6af76860a7f, 0x000aac6c116dd398, 0xfe7d2e8c24d8b803, 0x124340df740c6fa9,
         0x0079c5eb0637fe73, 0x7944afc0ff1009d9, 0xa0148366a205a053, ],
        [0x9c6c8c308f028f2a, 0xbd49b01769781ad8, 0xc298abe4933e64e6, 0x68299a8480b39586,
         0x5edc7f506869254c, 0x04a1986257aae51c, 0x4bcdd8a24f1a99a9, ],
        [0x9ca8e962bd059dc9, 0x9a626f0eb6cac83e, 0x6e430f26303037d1, 0x6aefa87777f45a49,
         0x3d7fcc4439d38978, 0x44211d06e20907de, 0xd6e4b4f799900be3, ],
        [0x02e2af6165e708e3, 0x785e82d601a43dd7, 0xb3a138ecb50af6de, 0x36a1a8ac0f89ddcc,
         0x4a8b852aa4493014, 0xc57935431ef81b37, 0x40006567ed46d212, ],
        [0x8cfab25215607ac7, 0x4ab863f084ed6430, 0x268b99c9f75af5d0, 0xd56d5c1c3284d270,
         0xf237ee32fdafd8a9, 0xa079a403c8b987ae, 0x33db8b9fd2d75879, ],
        [0xc064ed91af2d4bd7, 0x4677d6c4633d98a0, 0x3a9d35be9d0fc658, 0x34751b6c01cb7a88,
         0x6c4b8654b0604000, 0x46391a645157e75b, 0x597773ea8c85d1e3, ],
        [0x39efcab7be813372, 0x28b867a214e84305, 0x533e084cf4355d1f, 0xf7f35dca88fb35cf,
         0x46e46cd537b9b88d, 0x7fd6630da6fa9a6b, 0xc6aec22fe69e69d0, ],
        [0x18f0d845e71fe62d, 0x6f3ebc8f3d240d10, 0x2ce435e43ea53811, 0xd9e4b15526e4ec74,
         0x4643bd3a6faace83, 0x471467765e0ff275, 0x34b4200c5b5c907a, ],
        [0xb84755ff6307206f, 0x6fc14dc4deb435e6, 0xa3a23459e8037fdf, 0xe616ab568266e558,
         0xd52994042b13a196, 0x09aa16337db49ac3, 0x727edced21e322df, ],
        [0x056b9b85cb18d331, 0x0229e989dafe6d36, 0x4d2ab65902fe4ac5, 0x3590b87c91a321fb,
         0x953acef5bf6e4038, 0x6923660ce70dcd51, 0x89443931a4123e5b, ],
        [0x2cd68eead7353bc8, 0x84dc956dc2854318, 0x05c0ba3a7ad92747, 0x7efc77b19e231524,
         0x8848dba8762b9dc0, 0x2f28b8bf58b9251c, 0xd0ee4ae56a83af96, ],
        [0x002063f39cf1263e, 0x000853f83fc93798, 0x00064bc6146db0f8, 0x000565db3aada9f2,
         0x0004c4ddf994fe16, 0x0063a4dd6139d3d2, 0x10008b7dd187b390, ],
        [0x000000051994ef70, 0x000000034d7622bc, 0x000000029a554814, 0x00000032680e6fca,
         0x00000c004b3adaa4, 0x0001000406a0c0d2, 0x00000198359f1260, ],
        [0x0000000000011c90, 0x0000000000112518, 0x000000000800130a, 0x0000000100005124,
         0x0000000000900142, 0x0000000020080062, 0x0000000002011020, ],
        [0x0000000000000400, 0x0000000000010000, 0x0000000000000008, 0x0000000000001000,
         0x0000000000000100, 0x0000000000000002, 0x0000000000000020, ],
    ];

    const FAST_PARTIAL_ROUND_W_HATS: [[u64; 8 - 1]; N_PARTIAL_ROUNDS] = [
        [0xcc5554d28363659f, 0x55aaf01a458b27ce, 0xf77957c5c1c5dae5, 0x411a8f7e9892a502,
         0x624cf51a3c2203bd, 0x21879301bbef1808, 0xad2cc4e86e968978, ],
        [0x89ef2a0c3bfcb185, 0x4f3ae947ee75ef93, 0x1db2b528a478a809, 0xe07b8b867d9d51ca,
         0x2de4ee14febe2593, 0xe898be8ddde8102c, 0xde3c3cce01b6ea0d, ],
        [0xd2b1c49776859930, 0x66d340678cb9ce54, 0x65a21f1b03a334b3, 0x6abc3ef751773d8d,
         0x884338a91df51146, 0x9dd740354b475f05, 0xebeb8975c5352ccd, ],
        [0x7752a8a3410923cd, 0xa29fc96868646393, 0x42cfda9e18ab98db, 0x1d2b7ee84206867e,
         0xa11ca3c701e175a2, 0x9c2d86f71b02e8e9, 0xb1e209013f3c8e4f, ],
        [0x15fa237914627950, 0x9ba2e64d587756bf, 0x27d4909933d9c69a, 0xa524b2c7d527660b,
         0x603ab66e7fde9f79, 0x41e86ab2101dd3bd, 0x0691a9ccf40469b2, ],
        [0xfc4741285166957f, 0xd0d28f131a990beb, 0x6285e517b9b096a6, 0xa4528f64bcb04198,
         0xebf4505e9945a05c, 0xf743ecc9cfd5adbb, 0x8d09c9a0af84e1a6, ],
        [0xf1367e94c07b1705, 0x1c4c625b19dbdc63, 0x1d3d8b5ba5400406, 0xcb1f66063d5c07c8,
         0xe1b3a9fda7812232, 0xc50663c7b14e0cc8, 0x2798742132096f1c, ],
        [0x974b776fe3157ae7, 0x760551290872e0e4, 0xf302c415f3c46d52, 0x81604632786a53e9,
         0x1afef940f460bbdb, 0xc539d0267cc57588, 0xd10b355d5627a2a1, ],
        [0x4723d8bd5cbf301b, 0xdec3ba4e73271151, 0xef1d431487e27a27, 0x4c1f153b09ddb943,
         0xcf6498892de8ee5d, 0x9c6b09dc9a902b2a, 0xd4fa7301a6c3608d, ],
        [0x58a299f02eaff91e, 0xd664d920486c22d6, 0xfb90102a24534313, 0x83fa9cb0d9cb5edd,
         0x30caa4c641e4fea5, 0xb7900410a2b7c4b6, 0x3bf6d74004777d1b, ],
        [0xce454adf0146458a, 0x8966f96f25f5447c, 0x3c6779e583cf6b33, 0x935227233a12a53a,
         0x5eaf904a7e706893, 0x8eb6fa80b3db6994, 0x33779aed92430367, ],
        [0x959067e21898e51c, 0xf9772cf9f741a438, 0x2aa725d02e8a7b28, 0x054c243dc860b5f1,
         0xdd39c66c61566f45, 0x42bf31878ec0f800, 0xbf85700b5cc25771, ],
        [0x9d190a97bec836e1, 0xb233608ccc430992, 0xb337a659e498944d, 0xcd3f12c135d6e7f1,
         0x4aa0dde99e252807, 0xe8befade85ead476, 0x7143f052044b0e40, ],
        [0x2a4fcd1253dd054e, 0xc94d1149becb759f, 0xfecf0b3e924d1e5e, 0x8a6d1daffd2b6a53,
         0x0588e5fb19435c3d, 0xc59345f4dbae877b, 0xd6df137c270d5d00, ],
        [0x8ca1445abbd1d5ce, 0x8d346b247163e93c, 0xd4ff9724b5fd1149, 0x66ac423c2e428f8a,
         0x09f4687aafd9b561, 0xef75932c29062a0b, 0xa6ab608b45ffb891, ],
        [0x34470f03fc52f578, 0xaea57be4922b5573, 0xc6af8f55a25e1876, 0x7cdffbc943b6a1fc,
         0x43b7080e6b4180b9, 0x47102b89ef9e54b6, 0x7882ad6d51053a31, ],
        [0xb23ebb64383dbdc9, 0x4011f6cded6d34cc, 0xc93938285905b153, 0xa0e16ec6e9a0c833,
         0x8cf008ee1bfab331, 0x53fa3158b54d4e85, 0x369afa42abde8f37, ],
        [0xa144c4b33ba80f6d, 0xeb88fc2997efb59c, 0x4be825c5809d7ef7, 0x42d1e5f3ee04886d,
         0x7554009c2b72dd2b, 0xa0367e97eaed7dfa, 0xf5dcbe186911abea, ],
        [0x63cc49b2d70d6d19, 0x02a0afdd1722c561, 0x8fc4a794f1541179, 0x8491b7346c24eb43,
         0xddb914fff1c38426, 0xdeef4e2dee362982, 0xd67760c5131c3696, ],
        [0xe03bf62a6966fbce, 0x8a4c9b0d36a3580d, 0x23625e28037e7be1, 0x63a1deca333f5ed9,
         0xc0d5bd9f1f59ee8c, 0xc1a24624b535b866, 0x8f3e5be06e1265b8, ],
        [0xaa7c259fbd68e5a7, 0x3c37ee1f618df35b, 0xa6123117c8ffa75a, 0x92e83e999e1e1fb6,
         0xdc62384e180a8157, 0xc071414e6a1df84e, 0x5b4c3b605868323c, ],
        [0x9dedbd2d045ebc40, 0xb174bc564554c5d0, 0xd7cbdd5d7347dc09, 0x0078b2f8cd36bd65,
         0x4bede49b3f19e9fe, 0xcae7cfc2e1b99e9c, 0x73f1c3df8546be5b, ],
    ];

    // NB: This is in ROW-major order to support cache-friendly pre-multiplication.
    const FAST_PARTIAL_ROUND_INITIAL_MATRIX: [[u64; 8 - 1]; 8 - 1] = [
        [0xff2b43d4b1edbcbc, 0x00033c141bc74f0d, 0xf37805abf0424db5, 0x7817aaa349ec6996,
         0x4c39de67134d5c8b, 0x70d884326c808dd1, 0xc7828d84c35b5401, ],
        [0xb62476e68badb364, 0x9f656d0833d33a52, 0x3de4a5b35f97f21c, 0xea55a54a6e0b00ab,
         0x5a98d4aad84125c3, 0xea043ee82191d439, 0x70d884326c808dd1, ],
        [0x03c85927e3b83579, 0xd5d25cfc58f19c92, 0x4ee3e4222008e3e0, 0x2f47088a7ee26b48,
         0x9b1422d0eb1069a3, 0x5a98d4aad84125c3, 0x4c39de67134d5c8b, ],
        [0xb6f6f914bfa7bc3c, 0x395498dd276aaaab, 0x8317950991352c87, 0x0dff62bfb869cfc3,
         0x2f47088a7ee26b48, 0xea55a54a6e0b00ab, 0x7817aaa349ec6996, ],
        [0xf7d5ac9192e2bf45, 0xea35cff28c9ce37b, 0x7a4594d1f6641df1, 0x8317950991352c87,
         0x4ee3e4222008e3e0, 0x3de4a5b35f97f21c, 0xf37805abf0424db5, ],
        [0x4afa70c7232f4bf1, 0x4ba3bc3024e4645a, 0xea35cff28c9ce37b, 0x395498dd276aaaab,
         0xd5d25cfc58f19c92, 0x9f656d0833d33a52, 0x00033c141bc74f0d, ],
        [0x397d24b2d9537f01, 0x4afa70c7232f4bf1, 0xf7d5ac9192e2bf45, 0xb6f6f914bfa7bc3c,
         0x03c85927e3b83579, 0xb62476e68badb364, 0xff2b43d4b1edbcbc, ],
    ];
}

#[rustfmt::skip]
impl Poseidon<12> for GoldilocksField {
    // The MDS matrix we use is the circulant matrix with first row given by the vector
    // [ 2^x for x in MDS_MATRIX_EXPS] = [1, 1, 2, 1, 8, 32, 2, 256, 4096, 8, 65536, 1024]
    //
    // WARNING: If the MDS matrix is changed, then the following
    // constants need to be updated accordingly:
    //  - FAST_PARTIAL_ROUND_CONSTANTS
    //  - FAST_PARTIAL_ROUND_VS
    //  - FAST_PARTIAL_ROUND_W_HATS
    //  - FAST_PARTIAL_ROUND_INITIAL_MATRIX
    const MDS_MATRIX_EXPS: [u64; 12] = [0, 0, 1, 0, 3, 5, 1, 8, 12, 3, 16, 10];

    const FAST_PARTIAL_FIRST_ROUND_CONSTANT: [u64; 12]  = [
        0x3cc3f89232e3b0c8, 0x3a8304bc56985013, 0x2a9f75c2280d2a8e, 0x53b9e0fac07c9b2b,
        0x276ef5190ab36dd6, 0xdccc95c1f434ce8d, 0x28d717d689301db6, 0x2662f1723650b872,
        0xc6b0375cf47850da, 0xbdfcca7661d81f17, 0x911992a4f6d9591f, 0xb718e4720c9f542f,
    ];

    const FAST_PARTIAL_ROUND_CONSTANTS: [u64; N_PARTIAL_ROUNDS]  = [
        0x1c92804be083d129, 0x81d932f4620fcfc6, 0x29f58a72045f76a0, 0x434472d6c6e34f30,
        0xc82c90fad781bb5c, 0xe6dfefae3135c450, 0xd0a0c9c9fff4798f, 0x97517f4034e7c8e6,
        0xae8b5030952e5949, 0xf77251b77cc297e2, 0x879c3a97606f1160, 0xed4e1e98780bdc19,
        0x5a9120e0c05b1660, 0xc4b244ea04b27221, 0x7fe9d55a335d7b82, 0xd69ff91c66ec999a,
        0x4c389b1b8180f1f5, 0x1b289f8c7fdeea1e, 0x3d464c75140b20e7, 0x74d158e1be40eb73,
        0xfc787193d2a84ea4, 0x0,
    ];

    const FAST_PARTIAL_ROUND_VS: [[u64; 12 - 1]; N_PARTIAL_ROUNDS] = [
        [0x9a5dd25dc32e6569, 0xd4b82de00e7510fa, 0x165bdcd7b344404a, 0xa85b4c126b8edfd4,
         0xcd2735bf92ab4f96, 0xdc07742c7da8ac41, 0x953fc266fc5ae49f, 0x0a151c20bfc847bf,
         0x0c550caef5afedb5, 0x74d28901888c5fa8, 0xdc51b68c30cc1741, ],
        [0x4f765e0a4246c828, 0xbbdc8cbadd477a84, 0x052a5abd7de2344c, 0xab88daa04d9c7fab,
         0xbc8fd7acbee798ef, 0xe55d796c0d8a7a09, 0x40824732ed2c556c, 0x298a94d56eabeaa4,
         0x719fcd5e11312b6c, 0x1ec9a560131d1ac7, 0xabc54a42497f7fd1, ],
        [0xb51f81e6eeeeb0d6, 0xc6f3c34e7161d1ef, 0x1e93b9e2255eed5b, 0xa78338e63ec48cc2,
         0xea6e89d1c7220a56, 0xaa52f6a1c2814bc5, 0x5896b6395e09fba0, 0xf7fc97a18d5f1eee,
         0xf2712e64111823e8, 0x4f84821bf1f857f4, 0x02041415d72da206, ],
        [0x39286a4a4a391e77, 0x4ac16c7bebc97214, 0x7427cbbcb895a01f, 0x2ef8491d0b14759b,
         0xbec7625ee20fa616, 0x7c64393faf749b6f, 0x0f61c751c9826dc5, 0x700e6f3ee8ccb8a7,
         0x5bdea3b447ef8667, 0xa0f569a5a6e97588, 0xcc9e78115d7cae2d, ],
        [0x0933079ab678e5ee, 0xed6861bf33c54a28, 0x62503e6e1749a497, 0x745a9c65dea83ac6,
         0x20ce351f6e700cf0, 0x2ec0b18d30fafb8a, 0x0312f54c22b5f299, 0x5222977218fd6cd5,
         0x82662e8445868eec, 0xc4cab6335040265d, 0x12e5790e9efb9217, ],
        [0x0d829aec63871f55, 0x384d8a425086dd8c, 0x13e78b54657bfd3e, 0x2a45a17a03093566,
         0x7b6872656233b9be, 0xddc0281bb12bbb4c, 0xa224ebff0652d7c8, 0xc5ca97207780ea5c,
         0x484236194d3586ba, 0x432a56d44a44f3f7, 0xc41f926f862fc532, ],
        [0x9366cd7ed9ef5e06, 0xd7f941098175f223, 0x9af7dda3e1c9f2b1, 0x9a0ec6d0a03525f5,
         0x3ab244f4fb0fb387, 0xd8c4e357eb1d5778, 0xe62157e2e25edbbb, 0xafcd6630f841f1f8,
         0xc3969199738708fb, 0xa8224d311e6a551f, 0xc2c0a01fc655fd9f, ],
        [0xd78498f2013cd9b6, 0x675d21a200b2908c, 0x70bfd23b9e88c707, 0x85472dcbcfd078e3,
         0x5658c961cfffd574, 0x89e05a2cda3ca315, 0x1b51ae1ff8186a9f, 0xca648f8c6c7822cb,
         0x7233c92647957f4d, 0x520bf21c62d37ffa, 0x897496c7407a2ca7, ],
        [0x8e80cf5bca4eee19, 0x754779126bc1afcf, 0x07e887764b379cb0, 0x7dc7c14e12f91d5e,
         0xc8f5dab5fb6b0264, 0x1c842cf8021f9176, 0x69b56a7e2e2db2c0, 0xf30253f77fef3445,
         0x14bb3a62919efb99, 0xff9976d424a5d89c, 0x59dde7be0331a202, ],
        [0xdbe04b62126330a2, 0x0409b2138da1eaec, 0x7bd4558eb2262691, 0xafa86cfa8d52b05b,
         0xb83f570197d8c584, 0xb3ded6cc13990ac1, 0xfd33937cb072c9e1, 0xe3b3989341d92952,
         0xd26e76d6ca949ad9, 0x35c89a8548f88e86, 0x8af785bd940c3b43, ],
        [0xcbf3b86701c790da, 0x63634f67e29f4005, 0x008f903982363b81, 0xc2b07f99d6eb0229,
         0xa8344b83d15e2558, 0x880f4e5fd103b7b0, 0xd40eddb0a5929072, 0x476e27ccee571f49,
         0xe71439b4b989f9eb, 0x97e55074f852b2fe, 0xdd258c2137e1a2c5, ],
        [0x982b90366d23259b, 0xb2667eacaa76b306, 0xecf233e82020ede1, 0x3cee7ac07d4a88c7,
         0x31428be2fe5a5854, 0xf1beea1d55c4c4db, 0x584fd6b580f1ffd2, 0x6e2381c3c8ba0d0b,
         0x21ab749cbafc0611, 0x8ed389f39aba3001, 0xa24ba694f2b42f13, ],
        [0xdb30cd9db02606f9, 0x1b0d6736682ba257, 0x0d3bcdecf5808443, 0x31c330001dbd3dbd,
         0x9684d22370447946, 0xde0e24e6426c6935, 0xf487270dd081ef69, 0xd943f4ef48f2b252,
         0x4c52a7fdd1c52d24, 0xc293082029ea139d, 0xc2ba73ab3da0468a, ],
        [0xd093bd0dcc74e0d1, 0xe91428f9ce6a98e5, 0x673dee716909dc21, 0xf22e3223548219d7,
         0x3297978d881a1300, 0x51157b1e8218d77c, 0x0e3b0a5c07843889, 0x273b48dfa36752b6,
         0x5dbf2c6323576866, 0x1c032b70763df9a7, 0x1a8d7ed4159ecbf4, ],
        [0x8e40b29fa6c4f3ad, 0x43bc06dba91daa9b, 0x445df1620dd6d846, 0xae1e72ed68c45c46,
         0x496ee4e593ade46d, 0x1d3642eddce9118f, 0x71a88114bd8fd755, 0x4a10d6b22514943d,
         0x56dca305d4d72fee, 0xe2e4d9ce95fa62bf, 0xfb6bfffd47b50b0a, ],
        [0x4c6c14946cc557ee, 0x9b1bcbaac7ba3226, 0xdd7410361fa0dd20, 0x9c8a098cbaf95b26,
         0x3da4f26593503adf, 0xffb07b45cd3bf859, 0xaf034373af54a559, 0xd6b9bace407146bb,
         0x7b92c04c972f4ec6, 0xfe71df71165b9845, 0xad0134b9dc9ebe51, ],
        [0xfdaa64ceec88aa7c, 0x565342e2d815525c, 0xe382458f259429a8, 0x0f6ba5afd5d1d1ca,
         0xcba85de412439a41, 0x212d3c62049ccb1a, 0x930c0bf5950267e3, 0x60f87fe43fc560d8,
         0x8f1fbdbcd878a33b, 0xd28b789abf9af16f, 0xd921f0434fa0eb07, ],
        [0xd69c2c80635e7c18, 0x5a3d78c8772f293f, 0x844fe5e72ad1ceb5, 0x81b217e5910dc916,
         0x2951409fb7c8ba85, 0x5c135dd95693e367, 0xc2e8a723f9f7ebd2, 0x10bb79bf5d63f38d,
         0x34625b1550385a89, 0xdc6235328d791163, 0x1eb12b7aed4d5133, ],
        [0x01426faca89577d0, 0x003ca90136ac4fd0, 0x00289223dc45a17f, 0x0009921704320612,
         0x0007efae3669e451, 0x006499f206b3349d, 0x1001120d9b5dcfe1, 0x000e3aa47db4da94,
         0x0320dc8339d35692, 0x4030a0a16247ecbd, 0x04368a659c160a6b, ],
        [0x0000001237b408f0, 0x00000004c8f1b79c, 0x0000000446de5309, 0x00000032a3e2d4ac,
         0x00000c007600eeb7, 0x000100040ee771b0, 0x00000198394d0817, 0x0000301810a981ba,
         0x0000030f37d86f5a, 0x0000030ab1cc04d4, 0x000000c0e7c0b7e9, ],
        [0x00000000000234a0, 0x0000000000114630, 0x000000000800260c, 0x0000000100005288,
         0x0000000000900194, 0x00000000200800a3, 0x0000000002011034, 0x000000000105100e,
         0x0000000000604025, 0x0000000000114a03, 0x0000000000061481, ],
        [0x0000000000000400, 0x0000000000010000, 0x0000000000000008, 0x0000000000001000,
         0x0000000000000100, 0x0000000000000002, 0x0000000000000020, 0x0000000000000008,
         0x0000000000000001, 0x0000000000000002, 0x0000000000000001, ],
    ];

    const FAST_PARTIAL_ROUND_W_HATS: [[u64; 12 - 1]; N_PARTIAL_ROUNDS] = [
        [0x54accab273d3aeca, 0x12fecae33b1f1da9, 0x573bb85449ea9a27, 0x6b5ddc139f172aad,
         0xd2b6d0ca34465d4c, 0x51cf0aafbddfc269, 0x6075e64679e7a403, 0x678316c041900ac9,
         0x10019c84b343fc57, 0xde5b81280922f644, 0x42490a86b2f2f305, ],
        [0x337c5930f7bacc46, 0x334792a4f1afb921, 0xc97ea5f1426e540e, 0x5fc74568337bd780,
         0xfd5718cc391d80ef, 0xef90b77a337d923c, 0xb28561998f153fea, 0xed5f65b8894345aa,
         0x7e2aacb5985893a7, 0xcbde536cb644fcf0, 0x07338300a07fc43b, ],
        [0xd4c9ad02fcc8b4c1, 0x2890dac7a1caa815, 0x7d62bc45c45f5db2, 0x0a902300db5deac2,
         0x663f3726307f62a4, 0x050bda7dc7d8eb3b, 0xd9db68f3f051c5b6, 0xc5110194a38210aa,
         0x403862136533be0e, 0x20039e053d9b227d, 0xe2c90d16262c5f3c, ],
        [0x6578da963396c755, 0xea6b546e6bc1e86f, 0x4e562ef0c66c2be3, 0x35b839dae0f9d22e,
         0x4aab3d88857b058c, 0x4f7443e07ac462d3, 0x93c2c5bbc385e50f, 0xc0c0c5c8ea023ce2,
         0x8409c53d4b62965d, 0x0489f2258135dcd1, 0x32958358c736aec9, ],
        [0xe13b50ca15b0a455, 0x9878071e2b5d4547, 0xb8e50d27b4172b30, 0xbf312f828d3ea142,
         0x5b8510573020e6e8, 0x7c3091c29d8d6afa, 0x7e2d900a50f194fa, 0xb236d5080d0b0409,
         0x08f148b6c3b99320, 0x679c6b9cadbe604c, 0x6b0313be2ad9b9f2, ],
        [0x12038ac320459b0e, 0x7abd36c6b25cd8e0, 0x37cc3583930e5a13, 0xafe725c4446a691d,
         0x99d89ccadeb38d80, 0x96c820be5528ec36, 0x9b63969fdc84ede6, 0x8f8f21cf5ad78c48,
         0x1a4d3573bc3c2d8b, 0x9f5a7bd9e771866e, 0x5bcef938b72497fc, ],
        [0x5f969817be6add7a, 0x572b04c1ae5a4c6d, 0x8d219b8fac9a287b, 0x4566b3c56372f434,
         0xdd3f46f108bf4441, 0xd7e1469baa3912c4, 0xac36377b68e071fc, 0xf348c609201d771a,
         0x0bb926a5e2ebdd96, 0x30efa780aee4705a, 0xb24ff2673691146a, ],
        [0x5d0324b3a1dab6e2, 0xbd1491a0cc9e564b, 0xb8699e13b528ef99, 0x7743d9a8753ee023,
         0xce577363cdb5bcbc, 0xc056688d4f006774, 0x61f9363c10d7fdf2, 0x5f730e5530f6e06d,
         0x25efb9ef3adf0072, 0xcf971d58e21a8aa7, 0xd830d7e8d0d70680, ],
        [0x36e69157ac42f39d, 0x3e7aca69ddf62d3e, 0xbbbef86cac42bb30, 0xa2e793ae56c27043,
         0x2a315dc4bc40c8a0, 0x84022758f3b3af55, 0x668809e74e7a470d, 0xf2d91eaafdee1820,
         0x50f19afd16d03294, 0x30c087d3223bcd4b, 0xf5739d95458cc633, ],
        [0x15266b5a75028317, 0x8059f198c9f88799, 0x437a070386c65244, 0xc70e0bb73942929d,
         0xa8b32cb37ae137ea, 0xc2e556278323a459, 0xbc486da754091692, 0x7815a23467d6b541,
         0x3e6dba4e930e8be6, 0x6b4277b0915d56ba, 0x20212bfac7922ea0, ],
        [0xeeba270c067b0c8b, 0xa4d576458941f29a, 0xecdf04a28c8c83be, 0xc808f0af215d7dda,
         0x424f4bfbecced0fb, 0xe4cbf6c0c10e58b3, 0x66a87bebfa09c031, 0x614ffc9443d5f0a4,
         0x96c96636f7b7975a, 0x58d4222a6f860cc5, 0x2d4f51c75bf50169, ],
        [0xab43452aec55310f, 0x0a719e77ec2b398c, 0x8f946888a3f5f74f, 0x7b447e0d9f7ad4fb,
         0x7a2887ceb40ef226, 0x8840b904c1c49e50, 0xd91ea2510b0eaddc, 0x6617fa40a1a220fb,
         0xb1c41a72a845cb45, 0x02c2715281868092, 0xaf5b1b6c46ca37bd, ],
        [0xe27649b9dbcbe631, 0x4afdf11d1d5e73b2, 0x05285a0e99160910, 0x23bfd6197ed8d3ba,
         0xb1e6292028792aab, 0xc997f6cc14e05cae, 0x34793ec255a555bd, 0xeb4f2da35a76dd03,
         0x767a5552c9910f3a, 0x4c4cc6987c30a447, 0x64da2b6920578f8d, ],
        [0xe97ce2fecc0720ac, 0x99fc5741fcdeae8a, 0x0ac47be58b345692, 0x75a446121f2cccda,
         0xf38e40a102691c8e, 0xdbe5d707594714ef, 0x6ab183bdab92e450, 0x0aed83850dc10451,
         0x66e16941a4373c93, 0x22af15bb3e1034a1, 0xab2136f22ed23ccc, ],
        [0xb0d3214d3c4c46c1, 0x3983bffd4053346c, 0xab1239b72a6a9e64, 0x669bcbda2406c089,
         0xf3118af8e563feda, 0x58323dbdd43a9c95, 0x5438aa910b51fd8c, 0xcbf071f9573f7e4f,
         0x476c8fde40075e51, 0xa10f54d3c77d8bed, 0xfecafe7ec7346beb, ],
        [0x79e00c6916f68fa8, 0x80e39c20c11400d6, 0x242e2b46a7c116b7, 0xea660990074fcff6,
         0x18e3369da4c9272b, 0xfa6471be8be33b80, 0xede2ed2a83a4574a, 0x9e595d610deaaed6,
         0xc7d2cf35fcacdc58, 0xc65cf113a9af2302, 0x35a74c3d0cac5fde, ],
        [0x35d6cf1a9aeabd4b, 0x4dc004b0b64954c3, 0xcb67ab54210b4c8f, 0xa2359b770621d28e,
         0x027a0a0a5e315bf6, 0xed6aad0492a86ef6, 0x127074e28969232c, 0x3e3d68e6354d396f,
         0x3cf204ab96edf7c6, 0x513a9050b70c18bf, 0x73b3b7399a3f5281, ],
        [0x0af9319d5b7cd620, 0x0514fbcecd8a897d, 0x542dd32e46738f8d, 0x49248ae425e9bd45,
         0x8bb9ef7ac36e53ea, 0x97981020c414a723, 0xe587f186c024e0c8, 0x14f01dd28e990ad2,
         0x4d3fca72e19ea756, 0x01a3824f1ee8e7f1, 0xb048d25b575f250e, ],
        [0xe78a4cfe6c6aa236, 0x4840deffdefd3b04, 0x6e0952d028e63e47, 0x249d49fb1d93304d,
         0xd41ce9ed49f7fbb3, 0xba255e808ea77466, 0x5ce52e6dc2005436, 0x8b5bf13acd881a04,
         0xf80f439f3ac011d1, 0x1d3618fb2cc3f916, 0xf41489c837e14938, ],
        [0x41e065665af15054, 0x71752ac86d1bba64, 0x9bfddd30f8ceadeb, 0x4f59dd5e6c985767,
         0x8aa3e0718ecaa657, 0x355f734ed4199ca2, 0x110f361baec4d693, 0x283a46e9e134b5b1,
         0x4fda33376f5c6514, 0xcca192f9565e7d13, 0x2251835db1c24c39, ],
        [0xc583f62f5970a849, 0xb6cc325741cd89dd, 0xf83288467f07ac1f, 0xfd82624964b845e7,
         0x11967e4e00a49fdd, 0x2fb200fae9f72577, 0xd6fb31913c7d5da7, 0xfad9ae578dd090cc,
         0xcd13b2be741ea5d8, 0xc1c54f9cf54b0c27, 0x29520a761b657cce, ],
        [0x0ac0e496a2b39f4a, 0x20571abb59e27953, 0xe9971143579a1d30, 0x980359c3dba518cb,
         0x05ecee5a85b427c4, 0x4620dd90ad0b5366, 0x95c98f9c5b859365, 0x0fbb1806fbc56995,
         0xfe4526fd802afae2, 0x70e3786431084092, 0xa8d78a0494939111, ],
    ];

    // NB: This is in ROW-major order to support cache-friendly pre-multiplication.
    const FAST_PARTIAL_ROUND_INITIAL_MATRIX: [[u64; 12 - 1]; 12 - 1] = [
        [0xb8dee12bf8e622dc, 0x2a0bcfdad25a7a77, 0x35f873e941f6055d, 0x99b7b85b6028982e,
         0x86d6993880e836f7, 0x1ef8de305b9c354d, 0x8b0a80ef933c37dc, 0x715c7164aacaf4a8,
         0x43845bd4f75ac7f5, 0x3e71bb7b0ec57a1a, 0xffc5b2f8946575c3, ],
        [0x863ca0992eae09b0, 0x68901dfa3ecc7696, 0x6ba9546fc13ba8be, 0x555b7567255c9650,
         0x4570c6ac5e80551b, 0x8e440c6cc2d0ed18, 0xbad8ae4dbfba0799, 0x8b71ed9e65a6ed7a,
         0xaade0f9eb69ee576, 0xdebe1855920c6e64, 0x3e71bb7b0ec57a1a, ],
        [0x2c3887c29246a985, 0x5aeb127ffeece78f, 0xa86e940514be2461, 0x2cb276ddf6094068,
         0x81e59e8f82a28b3c, 0x27bc037b1569fb52, 0x706ee8b692c2ebc7, 0xeba6949241aedb71,
         0xc416ad39f1f908f8, 0xaade0f9eb69ee576, 0x43845bd4f75ac7f5, ],
        [0x03df3a62e1ea48d2, 0xbb484c2d408e9b12, 0x0fbf2169623ec24c, 0x50955930c2f9eb19,
         0x3dfc3cc6123745cc, 0xa2a8d3774d197b2c, 0xd16417e43d20feab, 0xd998a362dba538ba,
         0xeba6949241aedb71, 0x8b71ed9e65a6ed7a, 0x715c7164aacaf4a8, ],
        [0xbbf73d77fc6c411c, 0xad7f124615d240ee, 0x4e413fcebe9020ee, 0x540bd8044c672f2b,
         0x6db739f6d2e9f37d, 0x9aa1b0a8f56ad33d, 0x53c179d92714378f, 0xd16417e43d20feab,
         0x706ee8b692c2ebc7, 0xbad8ae4dbfba0799, 0x8b0a80ef933c37dc, ],
        [0xab92e860ecde7bdc, 0xa58fc91c605c26d5, 0xfbe68b79a8d5e0b9, 0x3e7edc1407cbd848,
         0xf69c76d11eaf57bf, 0x941ef2c6beace374, 0x9aa1b0a8f56ad33d, 0xa2a8d3774d197b2c,
         0x27bc037b1569fb52, 0x8e440c6cc2d0ed18, 0x1ef8de305b9c354d, ],
        [0xb522132046b25eaf, 0x2b7b18e882c3e2c6, 0xe3322ad433ba15c8, 0x87355794faf87b1b,
         0x14f6e5ac86065fce, 0xf69c76d11eaf57bf, 0x6db739f6d2e9f37d, 0x3dfc3cc6123745cc,
         0x81e59e8f82a28b3c, 0x4570c6ac5e80551b, 0x86d6993880e836f7, ],
        [0x0084dd11f5c0d55c, 0x9d664d307df18036, 0x1d80d847dca52945, 0xee3eecb9b2df1658,
         0x87355794faf87b1b, 0x3e7edc1407cbd848, 0x540bd8044c672f2b, 0x50955930c2f9eb19,
         0x2cb276ddf6094068, 0x555b7567255c9650, 0x99b7b85b6028982e, ],
        [0xeb7c39655546eba5, 0xf07245b62d94cf71, 0x17db9b690f0031a3, 0x1d80d847dca52945,
         0xe3322ad433ba15c8, 0xfbe68b79a8d5e0b9, 0x4e413fcebe9020ee, 0x0fbf2169623ec24c,
         0xa86e940514be2461, 0x6ba9546fc13ba8be, 0x35f873e941f6055d, ],
        [0xcb7fc57923717f84, 0x795a850bf5f9e397, 0xf07245b62d94cf71, 0x9d664d307df18036,
         0x2b7b18e882c3e2c6, 0xa58fc91c605c26d5, 0xad7f124615d240ee, 0xbb484c2d408e9b12,
         0x5aeb127ffeece78f, 0x68901dfa3ecc7696, 0x2a0bcfdad25a7a77, ],
        [0x3107f5edca2f02b8, 0xcb7fc57923717f84, 0xeb7c39655546eba5, 0x0084dd11f5c0d55c,
         0xb522132046b25eaf, 0xab92e860ecde7bdc, 0xbbf73d77fc6c411c, 0x03df3a62e1ea48d2,
         0x2c3887c29246a985, 0x863ca0992eae09b0, 0xb8dee12bf8e622dc, ],
    ];
}
